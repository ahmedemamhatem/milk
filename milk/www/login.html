<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ميلك اند تشيز — دخول</title>
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root{
      --ink:#0b1324;
      --body:#1f2937;
      --muted:#667085;
      --line:#e5e7eb;

      --blue-50:#eff6ff;
      --blue-100:#dbeafe;
      --blue-200:#bfdbfe;
      --blue-300:#93c5fd;
      --blue-400:#60a5fa;
      --blue-500:#3b82f6;
      --blue-600:#2563eb;
      --blue-700:#1d4ed8;
      --blue-800:#1e40af;

      --glass: rgba(255,255,255,0.9);
      --glass-bd: rgba(15,23,42,0.08);
      --ring: rgba(37,99,235,0.22);

      --fs-hero: clamp(22px, 2.6vw, 30px);
      --fs-title: clamp(16px, 1.2vw, 18px);
      --fs-body: 14.5px;
      --fs-caption: 12.5px;

      --radius-lg: 22px;
      --radius-md: 14px;

      --shadow-lg: 0 28px 80px rgba(2,6,23,0.16), 0 8px 22px rgba(2,6,23,0.08);
      --shadow-md: 0 20px 56px rgba(2,6,23,0.12), 0 6px 14px rgba(2,6,23,0.06);
      --shadow-sm: 0 10px 24px rgba(2,6,23,0.08), 0 4px 10px rgba(2,6,23,0.06);
    }

    html, body { height:100%; }
    body {
      margin:0;
      font-family:"Cairo","Tajawal",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans Arabic","Noto Sans",sans-serif;
      color:var(--body);
      background:
        radial-gradient(60% 60% at 75% 30%, rgba(191,219,254,0.28) 0%, rgba(191,219,254,0) 60%) no-repeat,
        linear-gradient(180deg, #f8fafc 0%, #eef2f7 100%);
      overflow: hidden;
      letter-spacing: 0.1px;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    /* Background logo (kept) */
    .bg { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
    .bg::before {
      content:""; position:absolute; inset:0;
      background:
        radial-gradient(52% 52% at 50% 35%, rgba(59,130,246,0.10) 0%, rgba(59,130,246,0) 60%) no-repeat,
        linear-gradient(180deg, rgba(255,255,255,0.65), rgba(255,255,255,0.78));
    }
    .bg-logo { position:absolute; inset:0; display:grid; place-items:center; }
    .bg-logo img {
      width: min(1200px, 72vw); height: auto; max-height: 78vh; object-fit: contain;
      filter: saturate(1.05); opacity: 0.85; transform: translateZ(0);
    }

    /* Top bar with login button */
    .topbar {
      position: sticky; top: 0; z-index: 5;
      display: flex; align-items: center; justify-content: space-between;
      padding: 10px clamp(14px, 3vw, 24px);
      background: linear-gradient(180deg, rgba(255,255,255,0.86), rgba(255,255,255,0.7));
      border-bottom: 1px solid var(--line);
      backdrop-filter: blur(8px);
    }
    .brand-mark {
      display: inline-flex; align-items:center; gap:10px;
      font-weight: 900; color: var(--blue-700);
    }
    .brand-logo {
      width: 36px; height: 36px; border-radius: 10px; background:#fff; border:1px solid var(--line);
      display:flex; align-items:center; justify-content:center; font-size: 20px;
      box-shadow: var(--shadow-sm);
    }
    .brand-name {
      display:grid; gap: 2px; line-height: 1.05;
    }
    .brand-name .ar { font-size: 18px; color: var(--ink); }
    .brand-name .en { font-size: 12px; color: var(--muted); font-weight:800; }

    .btn-login-top {
      appearance: none; border:1px solid var(--blue-300);
      background: linear-gradient(135deg, var(--blue-600), var(--blue-500));
      color:#fff; font-weight:1000; border-radius: 12px; height:40px; padding: 0 14px; cursor:pointer;
      box-shadow: 0 10px 24px rgba(37,99,235,0.22);
      transition: transform 90ms ease, filter 160ms ease, box-shadow 160ms ease;
    }
    .btn-login-top:hover { filter:brightness(1.04); box-shadow: 0 14px 30px rgba(37,99,235,0.26); }
    .btn-login-top:active { transform: translateY(1px) scale(0.996); }

    /* Frame: left/right layout */
    .frame {
      position: relative; z-index: 1; height: calc(100vh - 62px); width: 100%;
      display: grid;
      grid-template-columns: minmax(360px, 520px) 1fr minmax(360px, 480px);
      gap: clamp(18px, 4vw, 60px);
      padding: clamp(10px, 2.2vw, 28px);
      align-items: stretch; box-sizing: border-box; max-width: 1680px; margin: 0 auto;
    }
    .edge-left  { grid-column: 1; justify-self: start; align-self: center; }
    .edge-right { grid-column: 3; justify-self: end;   align-self: stretch; }

    /* Card base */
    .card {
      border-radius: var(--radius-lg);
      background: var(--glass);
      border: 1px solid var(--glass-bd);
      backdrop-filter: blur(10px) saturate(1.06);
      -webkit-backdrop-filter: blur(10px) saturate(1.06);
      box-shadow: var(--shadow-md);
      overflow: hidden;
    }

    /* LEFT: Image (centered text) with enhanced colors */
    .left-card {
      width: min(520px, 94vw);
      display: grid;
      grid-template-rows: auto auto 1fr;
      text-align: center;
    }
    .left-head{
      display:grid; grid-template-columns: 1fr; justify-items: center; gap:8px;
      padding:18px; border-bottom:1px solid var(--line);
      background:
        linear-gradient(180deg, rgba(255,255,255,0.94), rgba(255,255,255,0.78)),
        radial-gradient(150% 70% at 0% 0%, rgba(191,219,254,0.32), rgba(191,219,254,0) 60%);
    }
    /* Enhanced title: blue gradient text with subtle shadow */
    .left-title{
      font-weight:1000; font-size: var(--fs-hero);
      background: linear-gradient(90deg, var(--blue-800), var(--blue-500));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      letter-spacing: 0.2px;
      text-shadow: 0 1px 0 rgba(255,255,255,0.9);
    }
    /* Enhanced subtitle: pill badge style */
    .left-sub{
      display: inline-flex; align-items:center; gap:8px;
      padding: 6px 12px; border-radius: 999px;
      background: linear-gradient(180deg, var(--blue-100), #ffffff);
      border: 1px solid var(--blue-200);
      color: var(--blue-800);
      font-size: var(--fs-caption); font-weight: 900;
      box-shadow: 0 6px 14px rgba(30,64,175,0.08);
    }

    .left-body{
      padding: 12px;
      display:flex; flex-direction: column; gap: 12px; align-items: center;
      background: linear-gradient(180deg, var(--blue-50), rgba(255,255,255,0.6));
      text-align: center;
    }
    .brand-image{
      max-width: 100%; height: auto; max-height: 36vh; object-fit: contain;
      border-radius: 16px; border: 1px solid var(--blue-100); background:#fff;
      box-shadow: var(--shadow-sm);
      transition: transform 160ms ease;
    }
    .brand-image:hover { transform: translateY(-2px); }
    .brand-image.secondary{ max-height: 22vh; }

    /* RIGHT: Brand/Data */
    .brand { height:100%; width:min(480px,96vw); display:flex; flex-direction:column; padding:0; }
    .brand-head{
      display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center;
      padding:14px 14px 10px 14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.92), rgba(255,255,255,0.75)),
        radial-gradient(140% 80% at 100% 0%, rgba(147,197,253,0.28), rgba(147,197,253,0) 60%);
      border-bottom:1px solid var(--line);
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }
    .brand-ico-right{
      width:46px; height:46px; border-radius:12px; background:#fff; border:1px solid var(--glass-bd);
      display:flex; align-items:center; justify-content:center; box-shadow:0 4px 12px rgba(2,6,23,0.06);
      font-size:24px; line-height:1;
    }
    .brand-title .ar{ font-weight:1000; font-size: 20px; color: var(--blue-800); text-shadow: 0 1px 0 rgba(255,255,255,0.85); }

    .brand-desc{
      padding: 10px 16px 12px 16px;
      background: linear-gradient(180deg, var(--blue-50), rgba(255,255,255,0.75));
      border-bottom:1px solid var(--blue-200);
      color: var(--ink);
      font-weight: 1000; font-size: 15px; line-height: 1.7;
    }

    .cards{ flex:1 1 auto; overflow:auto; padding:12px; display:grid; gap:14px; scrollbar-width:thin; scrollbar-color:#cbd5e1 transparent; background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.45)); border-radius: 0 0 var(--radius-lg) var(--radius-lg); }
    .cards::-webkit-scrollbar{ width:8px; } .cards::-webkit-scrollbar-thumb{ background:#cbd5e1; border-radius:8px; }

    .info{
      border-radius: var(--radius-md); padding:14px; display:grid; gap:8px;
      border:1px solid var(--blue-200);
      background: linear-gradient(180deg, var(--blue-50), #ffffff);
      box-shadow: var(--shadow-sm);
      transition: transform 160ms ease, box-shadow 160ms ease;
    }
    .info:hover { transform: translateY(-2px); box-shadow: 0 14px 36px rgba(2,6,23,0.08); }
    .info .top{ display:grid; grid-template-columns: 1fr auto; align-items:center; gap:10px; }
    .info h3{ margin:0; font-size: var(--fs-title); font-weight:1000; color: var(--blue-800); }
    .info p{ margin:0; font-size: var(--fs-body); font-weight:800; line-height:1.65; color:#334155; }

    .chip{
      display:inline-flex; align-items:center; gap:6px;
      height:28px; padding:0 10px; border-radius:999px; font-weight:900; font-size:12.5px;
      background: var(--blue-100); border:1px solid var(--blue-200); color: var(--blue-800);
    }
    .chip .dot{ width:8px; height:8px; border-radius:50%; background: var(--blue-600); box-shadow: 0 0 0 3px rgba(59,130,246,0.18); }

    .emoji{ font-size:14px; margin-inline-start: 6px; }

    /* Modal login popup */
    .modal-backdrop {
      position: fixed; inset: 0; display: none;
      align-items: center; justify-content: center;
      background: rgba(2,6,23,0.38);
      z-index: 50; padding: 16px;
    }
    .modal {
      width: min(520px, 96vw);
      border-radius: var(--radius-lg);
      background: var(--glass);
      border: 1px solid var(--glass-bd);
      box-shadow: var(--shadow-lg);
      transform: translateY(10px) scale(0.98);
      opacity: 0;
      transition: transform 220ms ease, opacity 220ms ease;
      overflow: hidden;
    }
    .modal.show { transform: translateY(0) scale(1); opacity: 1; }
    .modal-head {
      display:flex; align-items:center; gap:10px;
      padding: 14px 16px; border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,0.88), rgba(255,255,255,0.7));
    }
    .modal-title { font-weight:1000; font-size:18px; color: var(--ink); }
    .ico { width: 36px; height: 36px; border-radius: 10px; background:#fff; border:1px solid var(--line); display:flex; align-items:center; justify-content:center; font-size: 20px; }
    .modal-body { padding: 12px 16px 16px; }
    .modal-actions { display:flex; gap:10px; justify-content: space-between; align-items:center; margin-top: 10px; }

    .in-wrap{ position:relative; border-radius:12px; overflow:hidden; border:1px solid var(--line); background:#eef2ff; transition: box-shadow 140ms ease, border-color 140ms ease, background-color 140ms ease; }
    .in{ width:100%; height:50px; border:0; background:transparent; padding:12px 14px; font-size: var(--fs-body); outline:none; color:var(--ink); }
    .in-wrap:focus-within{ border-color: var(--blue-500); box-shadow: 0 0 0 6px var(--ring); background:#fff; }
    label{ display:block; font-weight:900; font-size: var(--fs-caption); margin:10px 0 6px; color:#0b1220; }

    .btn-submit{
      flex: 1 1 auto; height:48px; border-radius:12px; border:1px solid var(--blue-300);
      color:#fff; background: linear-gradient(135deg, var(--blue-600) 0%, var(--blue-500) 55%, var(--blue-400) 100%);
      font-weight:1000; letter-spacing:0.2px; box-shadow:0 12px 28px rgba(37,99,235,0.24); cursor:pointer;
    }
    .btn-cancel{
      height:48px; border-radius:12px; border:1px solid var(--line); background:#fff; color: var(--blue-800);
      font-weight:900; padding: 0 14px; cursor:pointer;
    }

    /* Responsive */
    @media (max-width: 980px){
      body { overflow:auto; }
      .frame{ height:auto; min-height:100vh; grid-template-columns: 1fr; grid-template-rows: auto 18px auto; }
      .edge-left, .edge-right{ justify-self: stretch; align-self: auto; }
      .brand{ width:100%; }
      .brand-image{ max-height: 32vh; }
      .brand-image.secondary{ max-height: 20vh; }
      .cards{ max-height: 60vh; }
      .bg-logo img{ width: min(92vw, 720px); max-height: 60vh; opacity: 0.9; }
    }
  </style>
</head>
<body>
  <!-- Background -->
  <div class="bg" aria-hidden="true">
    <div class="bg-logo">
      <img src="/assets/milk/immages/bg.png" alt="">
    </div>
  </div>

  <!-- Top bar -->
  <header class="topbar">
    <div class="brand-mark">
      <div class="brand-logo" aria-hidden="true">🥛</div>
      <div class="brand-name">
        <div class="ar">ميلك اند تشيز</div>
        <div class="en">Milk & Cheese</div>
      </div>
    </div>
    <button id="openLoginTop" class="btn-login-top" type="button">تسجيل الدخول</button>
  </header>

  <div class="frame">
    <!-- Left: Images (no login button here) -->
    <section class="edge-left">
      <div class="card left-card" role="region" aria-label="ميلك اند تشيز — بطاقة اليسار">
        <div class="left-head">
          <div class="left-title">ميلك اند تشيز - Milk & Cheese</div>
          <div class="left-sub">مرحباً بك</div>
        </div>

        <div class="left-body">
          <img class="brand-image" src="/assets/milk/immages/logoo.png" alt="شعار ميلك اند تشيز">
          <img class="brand-image secondary" src="/assets/milk/immages/car.png" alt="سيارة نقل — ميلك اند تشيز">
        </div>
      </div>
    </section>

    <!-- Right: Brand/Data -->
    <section class="edge-right">
      <div class="card brand" role="region" aria-label="معلومات — ميلك اند تشيز">
        <div class="brand-head">
          <div class="brand-ico-right" aria-hidden="true">🧀</div>
          <div class="brand-title"><div class="ar">ميلك اند تشيز</div></div>
          <div aria-hidden="true" style="width:10px;"></div>
        </div>

        <div class="brand-desc">
          <strong>مرجع</strong> في تصنيع <strong>أنواع متعددة</strong> من <strong>الحليب</strong> و<strong>الأجبان</strong> بجودة عالية.
        </div>

        <div class="cards" aria-label="معلومات وميزات">
          <article class="info">
            <div class="top">
              <h3>جودة يومية موثوقة <span class="emoji">🥛</span></h3>
              <span class="chip"><span class="dot"></span> QA</span>
            </div>
            <p>سجّل جودة اللبن صباحاً ومساءً مع تتبّع الأنواع والقرى والسائقين ومراقبة نتائج التحاليل المخبرية.</p>
          </article>

          <article class="info">
            <div class="top">
              <h3>فواتير وإجراءات أسرع <span class="emoji">🧾</span></h3>
              <span class="chip"><span class="dot"></span> ERP</span>
            </div>
              <p>إنشاء فواتير الموردين والعملاء والمصاريف بسرعة، مع أرشفة المرفقات وتتبع الموافقات والتقارير الدقيقة.</p>
          </article>

          <article class="info">
            <div class="top">
              <h3>إنتاج الأجبان المتنوع <span class="emoji">🧀</span></h3>
              <span class="chip"><span class="dot"></span> MFG</span>
            </div>
            <p>تحويل اللبن إلى أنواع متعددة من الأجبان بمراحل معيارية، مع مراقبة المخزون وخطط الإنتاج وتكاليف التشغيل.</p>
          </article>

          <article class="info">
            <div class="top">
              <h3>جمع وتوريد اللبن <span class="emoji">🚚</span></h3>
              <span class="chip"><span class="dot"></span> LOG</span>
            </div>
            <p>تسجيل الكميات حسب القرى والسائقين والنقاط، مع تتبّع درجات الحرارة وأزمنة التسليم وتفريغ الحمولات.</p>
          </article>

          <article class="info">
            <div class="top">
              <h3>المخزون وتتبع الدُفعات <span class="emoji">📦</span></h3>
              <span class="chip"><span class="dot"></span> INV</span>
            </div>
            <p>إدارة دقيقة للدُفعات وتواريخ الانتهاء مع تنبيهات المخزون ورسوم بيانية لانسيابية المواد.</p>
          </article>

          <article class="info">
            <div class="top">
              <h3>الجودة والسلامة الغذائية <span class="emoji">✅</span></h3>
              <span class="chip"><span class="dot"></span> QMS</span>
            </div>
            <p>سجلات HACCP، فحوصات معيارية، تقارير انحراف، وإجراءات تصحيحية موثّقة وقابلة للتتبّع.</p>
          </article>
        </div>
      </div>
    </section>
  </div>

  <!-- Login modal -->
  <div id="loginModalBackdrop" class="modal-backdrop" aria-hidden="true">
    <section class="modal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
      <header class="modal-head">
        <div class="ico" aria-hidden="true">🔐</div>
        <div class="modal-title" id="loginTitle">تسجيل الدخول</div>
      </header>
      <div class="modal-body">
        <form id="loginForm" novalidate>
          <label for="email">اسم المستخدم أو البريد</label>
          <div class="in-wrap"><input id="email" name="usr" type="text" class="in" autocomplete="username" required /></div>

          <label for="pwd">كلمة المرور</label>
          <div class="in-wrap"><input id="pwd" name="pwd" type="password" class="in" autocomplete="current-password" required /></div>

          <div class="modal-actions">
            <button class="btn-cancel" id="cancelLogin" type="button">إلغاء</button>
            <button class="btn-submit" type="submit">دخول</button>
          </div>
        </form>
      </div>
    </section>
  </div>

  <script>
    (function(){
      // Openers: top bar button only
      const opener = document.getElementById('openLoginTop');
      const backdrop = document.getElementById('loginModalBackdrop');
      const modal = backdrop.querySelector('.modal');
      const cancelBtn = document.getElementById('cancelLogin');
      const form = document.getElementById('loginForm');

      function openModal(){
        backdrop.style.display = 'flex';
        requestAnimationFrame(()=>{
          modal.classList.add('show');
          backdrop.setAttribute('aria-hidden', 'false');
          setTimeout(()=> document.getElementById('email')?.focus(), 160);
        });
      }
      function closeModal(){
        modal.classList.remove('show');
        setTimeout(()=>{
          backdrop.style.display = 'none';
          backdrop.setAttribute('aria-hidden', 'true');
        }, 200);
      }

      opener.addEventListener('click', openModal);
      cancelBtn.addEventListener('click', closeModal);
      backdrop.addEventListener('click', (e)=> { if (e.target === backdrop) closeModal(); });
      document.addEventListener('keydown', (e)=> { if (e.key === 'Escape' && backdrop.style.display === 'flex') closeModal(); });

      // ERPNext login
      async function loginERPNext(usr, pwd){
        const body = new URLSearchParams({ usr, pwd });
        const res = await fetch('/api/method/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body
        });
        const data = await res.json().catch(()=> ({}));
        if (res.ok && (data?.message === 'Logged In' || data?.home_page)) {
          window.location.href = data?.home_page || '/app';
          return;
        }
        alert(data?._error_message || data?.exception || data?.message || 'بيانات الدخول غير صحيحة.');
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const usr = (form.usr.value || '').trim();
        const pwd = (form.pwd.value || '').trim();
        if (!usr || !pwd) { alert('من فضلك أدخل اسم المستخدم وكلمة المرور.'); return; }
        try { await loginERPNext(usr, pwd); } catch (ex) { alert('تعذر تسجيل الدخول.'); }
      });

      // If already logged in, skip to /app
      try {
        fetch('/api/method/frappe.auth.get_logged_user')
          .then(r => r.json())
          .then(d => { const u = d && (d.message || d.user); if (u && u !== 'Guest') location.replace('/app'); })
          .catch(()=>{});
      } catch(e){}
    })();
  </script>
</body>
</html>